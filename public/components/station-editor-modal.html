<!-- Unified Station Editor Modal -->
<style>
.tag-item {
    display: inline-flex;
    align-items: center;
    background-color: #3b82f6;
    color: white;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 14px;
    gap: 6px;
}

.tag-item:hover {
    background-color: #2563eb;
}

.tag-remove {
    cursor: pointer;
    opacity: 0.8;
    font-size: 12px;
    padding: 2px;
    border-radius: 50%;
    transition: all 0.2s;
}

.tag-remove:hover {
    opacity: 1;
    background-color: rgba(255, 255, 255, 0.2);
}

.tag-placeholder {
    color: #9ca3af;
    font-style: italic;
}

.business-result {
    padding: 8px 12px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    background-color: #f9fafb;
    cursor: pointer;
    transition: all 0.2s;
}

.business-result:hover {
    background-color: #f3f4f6;
    border-color: #3b82f6;
}

.business-result.selected {
    background-color: #dbeafe;
    border-color: #3b82f6;
}

.business-confidence {
    font-size: 12px;
    color: #6b7280;
    margin-left: auto;
}

.business-result .truncate {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 400px;
}

.business-result {
    max-width: 100%;
    overflow: hidden;
}

/* Collapsible card styles */
.collapsible-card {
    transition: all 0.3s ease;
}

.collapsible-header {
    cursor: pointer;
    transition: all 0.2s ease;
    border-radius: 0.75rem 0.75rem 0 0;
    user-select: none;
}

.collapsible-header:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.collapsible-header:active {
    background-color: rgba(0, 0, 0, 0.1);
}

.collapsible-content {
    transition: all 0.3s ease;
    overflow: hidden;
}

.collapsible-content.collapsed {
    max-height: 0 !important;
    padding-top: 0 !important;
    padding-bottom: 0 !important;
    opacity: 0;
}

.collapsible-content.expanded {
    max-height: none;
    opacity: 1;
}

.chevron-icon {
    transition: transform 0.2s ease;
}

.chevron-icon.rotated {
    transform: rotate(180deg);
}

/* Responsive layout */
@media (max-width: 768px) {
    .desktop-two-column {
        grid-template-columns: 1fr !important;
    }
    .mobile-hide-on-collapse {
        display: none;
    }
    /* Improve mobile spacing */
    .collapsible-card {
        margin-bottom: 1rem;
    }
    /* Stack cards vertically with proper spacing */
    .space-y-6 > * + * {
        margin-top: 1rem;
    }
}
</style>
<div id="station-editor-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-xl max-w-7xl w-full max-h-[95vh] overflow-hidden flex flex-col">
        <!-- Header -->
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
            <div>
                <h2 class="text-xl font-bold text-gray-900">Station Editor</h2>
                <p class="text-sm text-gray-600" id="editor-station-name">Loading station...</p>
            </div>
            <div class="flex items-center space-x-3">
                <button onclick="saveStation()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-save mr-2"></i>Save Changes
                </button>
                <button onclick="deleteStation()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors" id="delete-station-btn">
                    <i class="fas fa-trash mr-2"></i>Delete
                </button>
                <button onclick="closeStationEditor()" class="p-2 text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-auto p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 desktop-two-column">
                <!-- Left Column: Form Inputs -->
                <div class="space-y-6">
                    <!-- Basic Info -->
                    <div class="bg-gray-50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                            Basic Information
                        </h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Station Name</label>
                                <input type="text" id="edit-name" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                                <input type="text" id="edit-country" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                                <input type="text" id="edit-city" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Genres</label>
                                <!-- Current Genres Display -->
                                <div id="current-genres" class="flex flex-wrap gap-2 mb-2 min-h-[2rem] p-2 border border-gray-200 rounded-lg bg-gray-50">
                                    <span class="text-sm text-gray-500 genre-placeholder">No genres selected</span>
                                </div>
                                <!-- Add Genre Dropdown -->
                                <div class="flex space-x-2">
                                    <div class="flex-1 relative">
                                        <select id="add-genre-select" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white">
                                            <option value="">Add Genre...</option>
                                            <!-- Options will be populated dynamically -->
                                        </select>
                                        <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                            <i class="fas fa-chevron-down text-gray-400"></i>
                                        </div>
                                    </div>
                                    <button type="button" onclick="showCustomGenreInput()" class="px-3 py-2 border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors">
                                        <i class="fas fa-plus mr-1"></i>Custom
                                    </button>
                                </div>
                                <div id="custom-genre-input" class="hidden mt-2">
                                    <input type="text" id="custom-genre" placeholder="Enter custom genre..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <div class="flex space-x-2 mt-2">
                                        <button type="button" onclick="addCustomGenre()" class="px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700">
                                            <i class="fas fa-check mr-1"></i>Add
                                        </button>
                                        <button type="button" onclick="cancelCustomGenre()" class="px-3 py-1 border border-gray-300 text-gray-700 rounded-md text-sm hover:bg-gray-100">
                                            <i class="fas fa-times mr-1"></i>Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Subgenres</label>
                                <!-- Current Subgenres Display -->
                                <div id="current-subgenres" class="flex flex-wrap gap-2 mb-2 min-h-[2rem] p-2 border border-gray-200 rounded-lg bg-gray-50">
                                    <span class="text-sm text-gray-500 subgenre-placeholder">No subgenres selected</span>
                                </div>
                                <!-- Add Subgenre Dropdown -->
                                <div class="flex space-x-2">
                                    <div class="flex-1 relative">
                                        <select id="add-subgenre-select" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white">
                                            <option value="">Add Subgenre...</option>
                                            <!-- Options will be populated dynamically -->
                                        </select>
                                        <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                            <i class="fas fa-chevron-down text-gray-400"></i>
                                        </div>
                                    </div>
                                    <button type="button" onclick="showCustomSubgenreInput()" class="px-3 py-2 border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors">
                                        <i class="fas fa-plus mr-1"></i>Custom
                                    </button>
                                </div>
                                <div id="custom-subgenre-input" class="hidden mt-2">
                                    <input type="text" id="custom-subgenre" placeholder="Enter custom subgenre..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <div class="flex space-x-2 mt-2">
                                        <button type="button" onclick="addCustomSubgenre()" class="px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700">
                                            <i class="fas fa-check mr-1"></i>Add
                                        </button>
                                        <button type="button" onclick="cancelCustomSubgenre()" class="px-3 py-1 border border-gray-300 text-gray-700 rounded-md text-sm hover:bg-gray-100">
                                            <i class="fas fa-times mr-1"></i>Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Types</label>
                                <!-- Current Types Display -->
                                <div id="current-types" class="flex flex-wrap gap-2 mb-2 min-h-[2rem] p-2 border border-gray-200 rounded-lg bg-gray-50">
                                    <span class="text-sm text-gray-500 type-placeholder">No types selected</span>
                                </div>
                                <!-- Add Type Dropdown -->
                                <div class="flex space-x-2">
                                    <div class="flex-1 relative">
                                        <select id="add-type-select" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white">
                                            <option value="">Add Type...</option>
                                            <!-- Options will be populated dynamically -->
                                        </select>
                                        <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                            <i class="fas fa-chevron-down text-gray-400"></i>
                                        </div>
                                    </div>
                                    <button type="button" onclick="showCustomTypeInput()" class="px-3 py-2 border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors">
                                        <i class="fas fa-plus mr-1"></i>Custom
                                    </button>
                                </div>
                                <div id="custom-type-input" class="hidden mt-2">
                                    <input type="text" id="custom-type" placeholder="Enter custom type..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <div class="flex space-x-2 mt-2">
                                        <button type="button" onclick="addCustomType()" class="px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700">
                                            <i class="fas fa-check mr-1"></i>Add
                                        </button>
                                        <button type="button" onclick="cancelCustomType()" class="px-3 py-1 border border-gray-300 text-gray-700 rounded-md text-sm hover:bg-gray-100">
                                            <i class="fas fa-times mr-1"></i>Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Stream URL</label>
                                <input type="url" id="edit-stream-url" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Homepage</label>
                                <input type="url" id="edit-homepage" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                                <input type="text" id="edit-language" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Bitrate (kbps)</label>
                                <input type="number" id="edit-bitrate" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Codec</label>
                                <input type="text" id="edit-codec" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Frequency/Medium 
                                    <span class="text-xs text-gray-500">(e.g., "101.5 FM", "AM 1010", "NET" for online)</span>
                                </label>
                                <input type="text" id="edit-frequency" placeholder="101.5 FM, AM 1010, or NET" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Fields -->
                    <div class="bg-gray-50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-cogs text-gray-600 mr-2"></i>
                            Advanced Fields
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <textarea id="edit-description" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Facebook</label>
                                    <input type="url" id="edit-facebook" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Twitter</label>
                                    <input type="url" id="edit-twitter" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Instagram</label>
                                    <input type="url" id="edit-instagram" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">YouTube</label>
                                    <input type="url" id="edit-youtube" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Owner</label>
                                    <input type="text" id="edit-owner" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Established Year</label>
                                    <input type="number" id="edit-established" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="edit-email" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                                    <input type="tel" id="edit-phone" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Favicon URL</label>
                                    <input type="url" id="edit-favicon" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                  </div>
                                  <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Logo URL</label>
                                    <input type="url" id="edit-logo" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                  </div>
                                  <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Local Image URL <span class="text-sm text-gray-500">(Our processed image)</span></label>
                                    <input type="url" id="edit-local-image" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50" readonly>
                                  </div>
                                  
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                                <textarea id="edit-address" rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Tags & Location -->
                    <div class="bg-blue-50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-map-marker-alt text-blue-600 mr-2"></i>
                            Location & Tags
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tags (comma-separated)</label>
                                <input type="text" id="edit-tags" placeholder="rock, canadian, classic" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Latitude</label>
                                    <input type="number" step="any" id="edit-latitude" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Longitude</label>
                                    <input type="number" step="any" id="edit-longitude" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>
                            <button onclick="autoLocate()" class="px-3 py-1 border border-blue-300 text-blue-700 rounded-md hover:bg-blue-100 transition-colors">
                                <i class="fas fa-map-marker-alt mr-1"></i>Auto-locate
                            </button>
                        </div>
                    </div>

                </div>

                <!-- Right Column -->
                <div class="space-y-6">
                    <!-- Scraper Tools -->
                    <div class="bg-yellow-50 rounded-xl collapsible-card">
                        <div class="collapsible-header p-4 rounded-t-xl" onclick="toggleCollapse('scraper-section')">
                            <h3 class="text-lg font-semibold text-gray-900 flex items-center justify-between">
                                <span class="flex items-center">
                                    <i class="fas fa-search text-yellow-600 mr-2"></i>
                                    Scraper Tools
                                </span>
                                <i class="fas fa-chevron-down chevron-icon rotated" id="scraper-section-chevron"></i>
                            </h3>
                        </div>
                        <div id="scraper-section" class="collapsible-content collapsed p-6 pt-0">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Google Maps or Website URL:</label>
                                <div class="flex space-x-2">
                                    <input type="url" id="scraper-url" placeholder="https://maps.google.com/... or https://example.com (will also scrape homepage if different)" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                    <button type="button" onclick="useHomepageUrl()" class="px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm">
                                        <i class="fas fa-home mr-1"></i>Use Homepage
                                    </button>
                                    <button type="button" onclick="findGoogleBusiness()" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm" id="find-google-btn">
                                        <i class="fas fa-search mr-1"></i>Find Business
                                    </button>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">
                                    <i class="fas fa-map-marker-alt mr-1"></i>
                                    Click "Find Business" to open Google Maps search in a new window
                                </div>
                                
                                <!-- Google Search Instructions -->
                                <div id="google-search-instructions" class="hidden"></div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="autoScrapeData()" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                                    <i class="fas fa-search mr-2"></i>Auto-Scrape
                                </button>
                                <button onclick="testScrapingUrl()" class="px-4 py-2 border border-yellow-300 text-yellow-700 rounded-lg hover:bg-yellow-100 transition-colors">
                                    <i class="fas fa-external-link-alt mr-2"></i>Test URL
                                </button>
                            </div>
                            <div id="scraped-data-preview" class="hidden">
                                <div class="text-sm font-medium text-gray-700 mb-2">Scraped Data Preview:</div>
                                <div class="bg-white border border-gray-200 rounded-lg p-3 max-h-64 overflow-y-auto">
                                    <div id="scraped-content" class="text-sm text-gray-600"></div>
                                </div>
                                <button onclick="applyScrapedData()" class="mt-2 px-3 py-1 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition-colors">
                                    Apply Scraped Data
                                </button>
                            </div>
                        </div>
                        </div>
                    </div>

                    <!-- Image Editor -->
                    <div class="bg-orange-50 rounded-xl collapsible-card">
                        <div class="collapsible-header p-4 rounded-t-xl" onclick="toggleCollapse('image-section')">
                            <h3 class="text-lg font-semibold text-gray-900 flex items-center justify-between">
                                <span class="flex items-center">
                                    <i class="fas fa-image text-orange-600 mr-2"></i>
                                    Image Editor
                                </span>
                                <i class="fas fa-chevron-down chevron-icon rotated" id="image-section-chevron"></i>
                            </h3>
                        </div>
                        <div id="image-section" class="collapsible-content collapsed p-6 pt-0">
                        <div class="space-y-4">
                            <div class="flex space-x-4">
                                <div class="flex-1">
                                    <div class="text-sm text-gray-700 mb-2">Current Image:</div>
                                    <div class="w-32 h-32 border border-gray-300 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center">
                                        <img id="current-image" class="w-full h-full object-contain hidden" alt="Station logo">
                                        <div id="no-image-placeholder" class="text-gray-400 text-center">
                                            <i class="fas fa-image text-2xl mb-2"></i>
                                            <div class="text-xs">No Image</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm text-gray-700 mb-2">Preview:</div>
                                    <div class="w-32 h-32 border border-gray-300 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center">
                                        <img id="preview-image" class="w-full h-full object-contain hidden" alt="Preview">
                                        <div id="preview-placeholder" class="text-gray-400 text-center">
                                            <i class="fas fa-eye text-2xl mb-2"></i>
                                            <div class="text-xs">Preview</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex space-x-2 mb-2">
                                <div class="flex">
                                    <button onclick="downloadStationImage(event)" class="px-3 py-2 bg-orange-600 text-white rounded-l-md hover:bg-orange-700 transition-colors text-sm">
                                        <i class="fas fa-download mr-1"></i>Download
                                    </button>
                                    <select id="download-size" class="px-2 py-2 bg-orange-600 text-white border-l border-orange-700 text-sm">
                                        <option value="original">Original</option>
                                        <option value="1024">1024px</option>
                                        <option value="512" selected>512px</option>
                                        <option value="256">256px</option>
                                    </select>
                                    <select id="download-source" class="px-2 py-2 bg-orange-600 text-white border-l border-orange-700 rounded-r-md text-sm">
                                        <option value="auto">Auto</option>
                                        <option value="logo">Logo</option>
                                        <option value="favicon">Favicon</option>
                                    </select>
                                </div>
                                <button onclick="uploadStationImage()" class="px-3 py-2 border border-orange-300 text-orange-700 rounded-md hover:bg-orange-100 transition-colors text-sm">
                                    <i class="fas fa-upload mr-1"></i>Upload
                                </button>
                                <button onclick="editStationImage()" class="px-3 py-2 border border-orange-300 text-orange-700 rounded-md hover:bg-orange-100 transition-colors text-sm">
                                    <i class="fas fa-edit mr-1"></i>Edit
                                </button>
                            </div>
                            <div>
                                <div class="text-sm text-gray-700 mb-2">Sizes:</div>
                                <div class="flex space-x-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" class="rounded border-gray-300 text-orange-600">
                                        <span class="ml-1 text-sm">128px</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="rounded border-gray-300 text-orange-600">
                                        <span class="ml-1 text-sm">256px</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="rounded border-gray-300 text-orange-600" checked>
                                        <span class="ml-1 text-sm">512px</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="rounded border-gray-300 text-orange-600">
                                        <span class="ml-1 text-sm">1024px</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>

                    <!-- Station Analysis -->
                    <div class="bg-purple-50 rounded-xl collapsible-card">
                        <div class="collapsible-header p-4 rounded-t-xl" onclick="toggleCollapse('analysis-section')">
                            <h3 class="text-lg font-semibold text-gray-900 flex items-center justify-between">
                                <span class="flex items-center">
                                    <i class="fas fa-brain text-purple-600 mr-2"></i>
                                    Smart Analysis
                                </span>
                                <i class="fas fa-chevron-down chevron-icon rotated" id="analysis-section-chevron"></i>
                            </h3>
                        </div>
                        <div id="analysis-section" class="collapsible-content collapsed p-6 pt-0">
                        <div class="space-y-4">
                            <div class="flex space-x-2">
                                <button onclick="analyzeStation()" id="analyze-btn" class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                    <i class="fas fa-search mr-2"></i>Analyze Station
                                </button>
                                <button onclick="testStreamConnectivity()" id="test-stream-btn" class="px-4 py-2 border border-purple-300 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors">
                                    <i class="fas fa-satellite-dish mr-2"></i>Test Stream
                                </button>
                            </div>
                            
                            <!-- Analysis Results Panel -->
                            <div id="analysis-results" class="hidden space-y-3">
                                <div class="text-sm font-medium text-gray-700 mb-2">Analysis Results:</div>
                                
                                <!-- Genres -->
                                <div id="suggested-genres" class="hidden">
                                    <div class="text-xs text-gray-600 mb-1">Suggested Genres:</div>
                                    <div class="flex flex-wrap gap-2" id="genre-suggestions"></div>
                                </div>
                                
                                <!-- Subgenres -->
                                <div id="suggested-subgenres" class="hidden">
                                    <div class="text-xs text-gray-600 mb-1">Suggested Subgenres:</div>
                                    <div class="flex flex-wrap gap-2" id="subgenre-suggestions"></div>
                                </div>
                                
                                <!-- Types -->
                                <div id="suggested-types" class="hidden">
                                    <div class="text-xs text-gray-600 mb-1">Suggested Types:</div>
                                    <div class="flex flex-wrap gap-2" id="type-suggestions"></div>
                                </div>
                                
                                <!-- Tags -->
                                <div id="suggested-tags" class="hidden">
                                    <div class="text-xs text-gray-600 mb-1">Suggested Tags:</div>
                                    <div class="flex flex-wrap gap-2" id="tag-suggestions"></div>
                                </div>
                                
                                <!-- Confidence and Sources -->
                                <div class="text-xs text-gray-500 mt-2">
                                    <span id="analysis-confidence"></span>
                                    <span id="analysis-sources" class="ml-2"></span>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="flex space-x-2 mt-3">
                                    <button onclick="applyAllSuggestions()" class="px-3 py-1 bg-green-600 text-white text-sm rounded-md hover:bg-green-700">
                                        <i class="fas fa-check mr-1"></i>Apply All
                                    </button>
                                    <button onclick="clearAnalysisResults()" class="px-3 py-1 border border-gray-300 text-gray-700 text-sm rounded-md hover:bg-gray-100">
                                        <i class="fas fa-times mr-1"></i>Clear
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Normalization Suggestions -->
                            <div id="normalization-suggestions" class="hidden">
                                <div class="text-sm font-medium text-gray-700 mb-2">Normalization Suggestions:</div>
                                <div id="genre-suggestion" class="text-sm"></div>
                                <div id="type-suggestion" class="text-sm"></div>
                                <div class="flex space-x-2 mt-2">
                                    <button onclick="applyNormalizationSuggestions()" class="px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700">
                                        <i class="fas fa-check mr-1"></i>Apply Suggestions
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Stream Test Results -->
                            <div id="stream-test-results" class="hidden">
                                <div class="text-sm font-medium text-gray-700 mb-2">Stream Test Results:</div>
                                <div id="stream-test-status" class="text-sm"></div>
                            </div>
                        </div>
                        </div>
                    </div>

                    <!-- Stream Health -->
                    <div class="bg-green-50 rounded-xl collapsible-card">
                        <div class="collapsible-header p-4 rounded-t-xl" onclick="toggleCollapse('health-section')">
                            <h3 class="text-lg font-semibold text-gray-900 flex items-center justify-between">
                                <span class="flex items-center">
                                    <i class="fas fa-heart-pulse text-green-600 mr-2"></i>
                                    Stream Health
                                </span>
                                <i class="fas fa-chevron-down chevron-icon rotated" id="health-section-chevron"></i>
                            </h3>
                        </div>
                        <div id="health-section" class="collapsible-content collapsed p-6 pt-0">
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Status:</span>
                                <div id="stream-status" class="flex items-center">
                                    <span class="health-indicator health-gray mr-2"></span>
                                    <span class="text-sm text-gray-600">Unknown</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Last Check:</span>
                                <span id="last-check" class="text-sm text-gray-600">Never</span>
                            </div>
                            <button onclick="testStreamHealth()" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-play mr-2"></i>Test Stream Now
                            </button>
                        </div>
                        </div>
                    </div>

                    <!-- Metadata Configuration -->
                    <div class="bg-cyan-50 rounded-xl collapsible-card">
                        <div class="collapsible-header p-4 rounded-t-xl" onclick="toggleCollapse('metadata-section')">
                            <h3 class="text-lg font-semibold text-gray-900 flex items-center justify-between">
                                <span class="flex items-center">
                                    <i class="fas fa-music text-cyan-600 mr-2"></i>
                                    Metadata Configuration
                                </span>
                                <i class="fas fa-chevron-down chevron-icon rotated" id="metadata-section-chevron"></i>
                            </h3>
                        </div>
                        <div id="metadata-section" class="collapsible-content collapsed p-6 pt-0">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Metadata API URL</label>
                                    <input type="url" id="edit-metadata-url" placeholder="https://api.example.com/nowplaying" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Metadata Type</label>
                                        <select id="edit-metadata-type" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                                            <option value="">Select type...</option>
                                            <option value="custom-api">Custom API</option>
                                            <option value="icecast-json">Icecast JSON</option>
                                            <option value="icecast-xml">Icecast XML</option>
                                            <option value="shoutcast">Shoutcast</option>
                                            <option value="socast">SoCast</option>
                                            <option value="onlineradiobox">OnlineRadioBox</option>
                                            <option value="rogers-auto">Rogers Auto (JSON Mapping)</option>
                                            <option value="radio-co">Radio.co</option>
                                            <option value="laut-fm">Laut.fm</option>
                                            <option value="website-scrape">Website Scraping</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Response Format</label>
                                        <select id="edit-metadata-format" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                                            <option value="">Auto-detect</option>
                                            <option value="json">JSON</option>
                                            <option value="xml">XML</option>
                                            <option value="html">HTML</option>
                                            <option value="jsonp">JSONP</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Custom Field Mapping (JSON)</label>
                                    <textarea id="edit-metadata-fields" rows="3" placeholder='{"title": "song.name", "artist": "artist.name"}' class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 font-mono text-sm"></textarea>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="testMetadataUrl()" class="px-3 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors text-sm">
                                        <i class="fas fa-play mr-1"></i>Test URL
                                    </button>
                                    <button onclick="discoverMetadataUrls()" class="px-3 py-2 border border-cyan-300 text-cyan-700 rounded-lg hover:bg-cyan-100 transition-colors text-sm">
                                        <i class="fas fa-search mr-1"></i>Discover URLs
                                    </button>
                                    <button onclick="openMetadataDiscovery()" class="px-3 py-2 border border-cyan-300 text-cyan-700 rounded-lg hover:bg-cyan-100 transition-colors text-sm">
                                        <i class="fas fa-external-link-alt mr-1"></i>Open Discovery Tool
                                    </button>
                                </div>
                                <div id="metadata-test-results" class="hidden">
                                    <div class="text-sm font-medium text-gray-700 mb-2">Test Results:</div>
                                    <div id="metadata-test-content" class="bg-white border border-gray-200 rounded-lg p-3 max-h-32 overflow-y-auto">
                                        <div class="text-sm text-gray-600"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quality & Curation -->
                    <div class="bg-indigo-50 rounded-xl collapsible-card">
                        <div class="collapsible-header p-4 rounded-t-xl" onclick="toggleCollapse('quality-section')">
                            <h3 class="text-lg font-semibold text-gray-900 flex items-center justify-between">
                                <span class="flex items-center">
                                    <i class="fas fa-star text-indigo-600 mr-2"></i>
                                    Quality & Curation
                                </span>
                                <i class="fas fa-chevron-down chevron-icon rotated" id="quality-section-chevron"></i>
                            </h3>
                        </div>
                        <div id="quality-section" class="collapsible-content collapsed p-6 pt-0">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Quality Score</label>
                                    <div class="flex items-center space-x-3">
                                        <input type="number" id="edit-quality-score" min="0" max="100" step="0.1" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                        <div class="flex items-center">
                                            <span class="text-sm text-gray-500 mr-2">/ 100</span>
                                            <button type="button" onclick="recalculateQualityScore()" class="px-2 py-1 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700">
                                                <i class="fas fa-calculator mr-1"></i>Calc
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="edit-editors-pick" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                            <span class="ml-2 text-sm text-gray-700">Editor's Pick</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="edit-featured" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                            <span class="ml-2 text-sm text-gray-700">Featured</span>
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="edit-is-active" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>
                                        <span class="ml-2 text-sm text-gray-700">Active</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50">
            <div class="text-sm text-gray-600">
                Station ID: <span id="editor-station-id">-</span>
            </div>
            <div class="flex space-x-3">
                <button onclick="deleteStation()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors" id="delete-station-btn-footer">
                    <i class="fas fa-trash mr-2"></i>Delete Station
                </button>
                <button onclick="resetStationForm()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors">
                    <i class="fas fa-undo mr-2"></i>Reset
                </button>
                <button onclick="closeStationEditor()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors">
                    <i class="fas fa-times mr-2"></i>Cancel
                </button>
                <button onclick="saveStation()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-save mr-2"></i>Save Changes
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modules are loaded dynamically by station-editor.js -->